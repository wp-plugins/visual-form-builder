jQuery(document).ready(function(g){if(window.VfbAdminPages){var f=VfbAdminPages.vfb_pages;if(pagenow==f.vfb){g(".if-js-closed").removeClass("if-js-closed").addClass("closed");postboxes.add_postbox_toggles(f.vfb)}}var c=null;g(document).on("mouseenter mouseleave",".vfb-tooltip",function(p){if(p.type=="mouseenter"){if(c){clearTimeout(c);c=null}var m=g(this).attr("title"),o=g(this).attr("rel"),n=g(this).width();g(this).append('<div class="tooltip"><h3>'+m+'</h3><p class="text">'+o+"</p></div>");g.data(this,"title",m);this.title="";g(this).find(".tooltip").css({left:n+22});c=setTimeout(function(){g(".tooltip").fadeIn(300)},500)}else{this.title=g.data(this,"title");g(".tooltip").fadeOut(500);g(this).children().remove()}});g(document).on("click","a.addOption",function(s){s.preventDefault();var n=g(this).parent().parent().find(".clonedOption").length;var r=n+1;var t=g(this).closest("div").attr("id");var q=g(this).closest("div").children("label").attr("for");var m=q.replace(new RegExp(/(\d+)$/g),"");var p=t.replace(new RegExp(/(\d+)$/g),"");var o=g("#"+t).clone().attr("id",p+r);o.children("label").attr("for",m+r);o.find('input[type="text"]').attr("id",m+r);o.find('input[type="radio"]').attr("value",r);g("#"+p+n).after(o)});g(document).on("click","a.deleteOption",function(n){n.preventDefault();var m=g(this).parent().parent().find(".clonedOption").length;if(m-1==0){alert("You must have at least one option.")}else{g(this).closest("div").remove()}});g(document).on("click","a.addEmail",function(s){s.preventDefault();var n=g(this).closest("#email-details").find(".clonedOption").length;var r=n+1;var t=g(this).closest("div").attr("id");var q=g(this).closest("div").find("label").attr("for");var m=q.replace(new RegExp(/(\d+)$/g),"");var p=t.replace(new RegExp(/(\d+)$/g),"");var o=g("#"+t).clone().attr("id",p+r);o.find("label").attr("for",m+r);o.find("input").attr("id",m+r);g("#"+p+n).after(o)});g(document).on("click","a.deleteEmail",function(n){n.preventDefault();var m=g(this).closest("#email-details").find(".clonedOption").length;if(m-1==0){alert("You must have at least one option.")}else{g(this).closest("div").remove()}});g('.option input[type="radio"]').mousedown(function(){g(this).attr("previousValue",g(this).prop("checked"))}).click(function(){var m=g(this).attr("previousValue");if(m=="true"){g(this).prop("checked",false)}});g(".menu-delete").click(function(){var m=(g(this).hasClass("entry-delete"))?"entry":"form";var n=confirm("You are about to permanently delete this "+m+" and all of its data.\n'Cancel' to stop, 'OK' to delete.");if(n){return true}return false});g(document).on("click","a.item-edit",function(m){m.preventDefault();g(m.target).closest("li").children(".menu-item-settings").slideToggle("fast");g(this).toggleClass("opened")});function l(m){if("FIELDSET"!==m){g("#vfb-fieldset-first-warning").show()}else{g("#vfb-fieldset-first-warning").hide()}}g("#vfb-menu-to-edit").nestedSortable({listType:"ul",maxLevels:3,handle:".vfb-menu-item-handle",placeholder:"vfb-sortable-placeholder",forcePlaceholderSize:true,forceHelperSize:true,tolerance:"pointer",toleranceElement:"> dl",items:"li:not(.ui-state-disabled)",create:function(m,n){g(this).css("min-height",g(this).height())},start:function(m,n){n.placeholder.height(n.item.height())},stop:function(n,o){var m=g("#vfb-menu-to-edit .item-type:first").text();opts={url:ajaxurl,type:"POST",async:true,cache:false,dataType:"json",data:{action:"visual_form_builder_sort_field",order:g(this).nestedSortable("toArray")},success:function(p){g("#loading-animation").hide();l(m);return}};g.ajax(opts)}});g("#form-items .vfb-draggable-form-items").click(function(m){m.preventDefault();g(this).data("submit_value",g(this).text())});g("#form-items .vfb-draggable-form-items").click(function(o){o.preventDefault();var p=g(this).closest("form").serializeArray(),n=g(this).data("submit_value"),m=g("#vfb-menu-to-edit li.ui-state-disabled:first").attr("id").match(new RegExp(/(\d+)$/g))[0];g("img.waiting").show();g.post(ajaxurl,{action:"visual_form_builder_create_field",data:p,field_type:n,previous:m,page:pagenow,nonce:g("#_wpnonce").val()}).done(function(q){g("img.waiting").hide();g(q).hide().insertBefore("#vfb-menu-to-edit li.ui-state-disabled:first").fadeIn()})});g(document).on("click","a.item-delete",function(u){u.preventDefault();var q=childs=new Array(),y=0,n=g(this).attr("href"),m=n.split("&"),s=confirm("You are about to permanently delete this field.\n'Cancel' to stop, 'OK' to delete.");if(!s){return false}for(var r=0;r<m.length;r++){var w=m[r].indexOf("=");var v=m[r].substring(0,w);var x=m[r].substring(w+1);q[v]=x}var o=g(this).closest(".form-item").find("ul").children();var p=o.parent().html();o.each(function(t){childs[t]=g(this).attr("id").match(new RegExp(/(\d+)$/g))[0]});var z=g(this).closest("li.form-item").parents("li.form-item");if(z.length){y=z.attr("id").match(new RegExp(/(\d+)$/g))[0]}g.post(ajaxurl,{action:"visual_form_builder_delete_field",form:q.form,field:q.field,child_ids:childs,parent_id:y,page:pagenow,nonce:q._wpnonce}).done(function(t){g("#form_item_"+q.field).addClass("deleting").animate({opacity:0,height:0},350,function(){g(this).before(p).remove()})})});g("#form-settings-button").click(function(o){o.preventDefault();g(this).toggleClass("current");g("#form-settings").slideToggle();var m=g('input[name="form_id"]').val(),n=(g(this).hasClass("current"))?"opened":"closed";g.post(ajaxurl,{action:"visual_form_builder_form_settings",form:m,status:n,page:pagenow}).done(function(p){if(n=="closed"){g(".settings-links").removeClass("on");g(".settings-links:first").addClass("on");g(".form-details").slideUp("normal");g(".form-details:first").show("normal")}})});g(".settings-links").click(function(o){o.preventDefault();g(".settings-links").removeClass("on");g(".form-details").slideUp("normal");if(g(this).next("div").is(":hidden")==true){g(this).addClass("on");g(this).next().slideDown("normal")}var n=g('input[name="form_id"]').val(),m=this.hash.replace(/#/g,"");g.post(ajaxurl,{action:"visual_form_builder_form_settings",form:n,accordion:m,page:pagenow})});var b=false;g("#vfb-form-builder-management input, #vfb-form-builder-management select, #vfb-form-builder-management textarea").change(function(){i()});function i(){b=true}window.onbeforeunload=function(){if(b){return"The changes you made will be lost if you navigate away from this page."}};g(document).on("submit","#visual-form-builder-update",function(){window.onbeforeunload=null});if(g(".columns-2 #side-sortables").length>0){var a=g("#vfb_form_items_meta_box"),d=a.offset(),e=a.nextAll(),h=false;g(window).on("scroll",function(){if(g(window).scrollTop()>d.top){a.stop().css({top:55,position:"fixed","z-index":"999"});if(e.is(":visible")){h=true;e.stop().css({opacity:0.1})}}else{a.stop().css({top:0,position:"relative"});if(h){e.stop().css({opacity:1})}}})}var k=g(".form-success-type:checked").val();g("#form-success-message-"+k).show();g(".form-success-type").change(function(){var m=g(this).val();switch(m){case"text":g("#form-success-message-text").show();g("#form-success-message-page, #form-success-message-redirect").hide();break;case"page":g("#form-success-message-page").show();g("#form-success-message-text, #form-success-message-redirect").hide();break;case"redirect":g("#form-success-message-redirect").show();g("#form-success-message-text, #form-success-message-page").hide();break}});g(".vfb-field-types").click(function(n){n.preventDefault();g("#vfb-field-tabs li").removeClass("tabs");g(this).parent().addClass("tabs");g(".tabs-panel-active").removeClass("tabs-panel-active").addClass("tabs-panel-inactive");var m=this.hash;g(m).removeClass("tabs-panel-inactive").addClass("tabs-panel-active")});g("#visual-form-builder-update").validate({rules:{"form_email_to[]":{email:true},form_email_from:{email:true},form_success_message_redirect:{url:true},form_notification_email_name:{required:function(m){return g("#form-notification-setting").is(":checked")}},form_notification_email_from:{required:function(m){return g("#form-notification-setting").is(":checked")},email:true},form_notification_email:{required:function(m){return g("#form-notification-setting").is(":checked")}}},errorPlacement:function(m,n){m.insertAfter(n.parent())}});g("#visual-form-builder-new-form").validate();g("#form_email_from_name_override").change(function(){if(g("#form_email_from_name_override").val()==""){g("#form-email-sender-name").prop("readonly",false)}else{g("#form-email-sender-name").prop("readonly","readonly")}});g("#form_email_from_override").change(function(){if(g("#form_email_from_override").val()==""){g("#form-email-sender").prop("readonly",false)}else{g("#form-email-sender").prop("readonly","readonly")}});g("#notification-email").toggle(g("#form-notification-setting").prop("checked"));g("#form-notification-setting").change(function(){var m=g(this).is(":checked");if(m){g("#notification-email").show();g("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").prop("disabled",false)}else{g("#notification-email").hide();g("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").prop("disabled","disabled")}});g("#vfb-export-select-all").click(function(m){m.preventDefault();g('#vfb-export-entries-fields input[type="checkbox"]').prop("checked",true)});g("#vfb-export-entries-forms").change(function(){var n=g(this).val(),m=j(n);g("#vfb-export-entries-fields").html("Loading...");g.get(ajaxurl,{action:"visual_form_builder_export_load_options",id:n,count:m,page:pagenow}).done(function(o){g("#vfb-export-entries-fields").html(o)}).fail(function(o){g("#vfb-export-entries-fields").html("Error loading entry fields.")})});g("#vfb-export-entries-rows").change(function(){var n=g("#vfb-export-entries-forms").val();var m=g(this).val();g("#vfb-export-entries-fields").html("Loading...");g.get(ajaxurl,{action:"visual_form_builder_export_load_options",id:n,offset:m,page:pagenow}).done(function(o){g("#vfb-export-entries-fields").html(o)}).fail(function(o){g("#vfb-export-entries-fields").html("Error loading entry fields.")})});function j(n){var m="";g.ajax(ajaxurl,{async:false,data:{action:"visual_form_builder_export_entries_count",id:n,page:pagenow}}).done(function(o){if(o>1000){g("#vfb-export-entries-rows").empty();var q=Math.ceil(parseInt(o)/1000);for(var p=1;p<=q;p++){g("#vfb-export-entries-rows").append(g("<option></option>").attr("value",p).text(p))}g("#vfb-export-entries-pages").show()}else{g("#vfb-export-entries-pages").hide()}m=o}).fail(function(o){});return m}});