jQuery(document).ready(function(f){if(pagenow=="toplevel_page_visual-form-builder"){f(".if-js-closed").removeClass("if-js-closed").addClass("closed");postboxes.add_postbox_toggles("toplevel_page_visual-form-builder")}var d=null;f(document).on("mouseenter mouseleave",".vfb-tooltip",function(n){if(n.type=="mouseenter"){if(d){clearTimeout(d);d=null}var k=f(this).attr("title"),m=f(this).attr("rel"),l=f(this).width();f(this).append('<div class="tooltip"><h3>'+k+'</h3><p class="text">'+m+"</p></div>");f.data(this,"title",k);this.title="";f(this).find(".tooltip").css({left:l+22});d=setTimeout(function(){f(".tooltip").fadeIn(300)},500)}else{this.title=f.data(this,"title");f(".tooltip").fadeOut(500);f(this).children().remove()}});f(document).on("click","a.addOption",function(q){q.preventDefault();var l=f(this).parent().parent().find(".clonedOption").length;var p=l+1;var r=f(this).closest("div").attr("id");var o=f(this).closest("div").children("label").attr("for");var k=o.replace(new RegExp(/(\d+)$/g),"");var n=r.replace(new RegExp(/(\d+)$/g),"");var m=f("#"+r).clone().attr("id",n+p);m.children("label").attr("for",k+p);m.find('input[type="text"]').attr("id",k+p);m.find('input[type="radio"]').attr("value",p);f("#"+n+l).after(m)});f(document).on("click","a.deleteOption",function(l){l.preventDefault();var k=f(this).parent().parent().find(".clonedOption").length;if(k-1==0){alert("You must have at least one option.")}else{f(this).closest("div").remove()}});f(document).on("click","a.addEmail",function(q){q.preventDefault();var l=f(this).closest("#email-details").find(".clonedOption").length;var p=l+1;var r=f(this).closest("div").attr("id");var o=f(this).closest("div").find("label").attr("for");var k=o.replace(new RegExp(/(\d+)$/g),"");var n=r.replace(new RegExp(/(\d+)$/g),"");var m=f("#"+r).clone().attr("id",n+p);m.find("label").attr("for",k+p);m.find("input").attr("id",k+p);f("#"+n+l).after(m)});f(document).on("click","a.deleteEmail",function(l){l.preventDefault();var k=f(this).closest("#email-details").find(".clonedOption").length;if(k-1==0){alert("You must have at least one option.")}else{f(this).closest("div").remove()}});f(".menu-delete, .entry-delete").click(function(){var k=(f(this).hasClass("entry-delete"))?"entry":"form";var l=confirm("You are about to permanently delete this "+k+" and all of its data.\n'Cancel' to stop, 'OK' to delete.");if(l){return true}return false});f(document).on("click","a.item-edit",function(k){k.preventDefault();f(k.target).closest("li").children(".menu-item-settings").slideToggle("fast");f(this).toggleClass("opened")});function j(k){if("FIELDSET"!==k){f("#vfb-fieldset-first-warning").show()}else{f("#vfb-fieldset-first-warning").hide()}}f("#vfb-menu-to-edit").nestedSortable({listType:"ul",maxLevels:3,handle:".vfb-menu-item-handle",placeholder:"vfb-sortable-placeholder",forcePlaceholderSize:true,forceHelperSize:true,tolerance:"pointer",toleranceElement:"> dl",items:"li:not(.ui-state-disabled)",create:function(k,l){f(this).css("min-height",f(this).height())},start:function(k,l){l.placeholder.height(l.item.height())},stop:function(l,m){var k=f("#vfb-menu-to-edit .item-type:first").text();opts={url:ajaxurl,type:"POST",async:true,cache:false,dataType:"json",data:{action:"visual_form_builder_sort_field",order:f(this).nestedSortable("toArray")},success:function(n){f("#loading-animation").hide();j(k);return}};f.ajax(opts)}});f("#form-items .vfb-draggable-form-items").click(function(k){k.preventDefault();f(this).data("submit_value",f(this).text())});f("#form-items .vfb-draggable-form-items").click(function(m){m.preventDefault();var n=f(this).closest("form").serializeArray(),l=f(this).data("submit_value"),k=f("#vfb-menu-to-edit li.ui-state-disabled:first").attr("id").match(new RegExp(/(\d+)$/g))[0];f("img.waiting").show();f.post(ajaxurl,{action:"visual_form_builder_create_field",data:n,field_type:l,previous:k,page:pagenow,nonce:f("#_wpnonce").val()}).done(function(o){f("img.waiting").hide();f(o).hide().insertBefore("#vfb-menu-to-edit li.ui-state-disabled:first").fadeIn()})});f(document).on("click","a.item-delete",function(r){r.preventDefault();var o=childs=new Array(),w=0,l=f(this).attr("href"),k=l.split("&"),q=confirm("You are about to permanently delete this field.\n'Cancel' to stop, 'OK' to delete.");if(!q){return false}for(var p=0;p<k.length;p++){var u=k[p].indexOf("=");var s=k[p].substring(0,u);var v=k[p].substring(u+1);o[s]=v}var m=f(this).closest(".form-item").find("ul").children();var n=m.parent().html();m.each(function(t){childs[t]=f(this).attr("id").match(new RegExp(/(\d+)$/g))[0]});var x=f(this).closest("li.form-item").parents("li.form-item");if(x.length){w=x.attr("id").match(new RegExp(/(\d+)$/g))[0]}f.post(ajaxurl,{action:"visual_form_builder_delete_field",form:o.form,field:o.field,child_ids:childs,parent_id:w,page:pagenow,nonce:o._wpnonce}).done(function(t){f("#form_item_"+o.field).addClass("deleting").animate({opacity:0,height:0},350,function(){f(this).before(n).remove()})})});f("#form-settings-button").click(function(m){m.preventDefault();f(this).toggleClass("current");f("#form-settings").slideToggle();var k=f('input[name="form_id"]').val(),l=(f(this).hasClass("current"))?"opened":"closed";f.post(ajaxurl,{action:"visual_form_builder_form_settings",form:k,status:l,page:pagenow}).done(function(n){if(l=="closed"){f(".settings-links").removeClass("on");f(".settings-links:first").addClass("on");f(".form-details").slideUp("normal");f(".form-details:first").show("normal")}})});f(".settings-links").click(function(m){m.preventDefault();f(".settings-links").removeClass("on");f(".form-details").slideUp("normal");if(f(this).next("div").is(":hidden")==true){f(this).addClass("on");f(this).next().slideDown("normal")}var l=f('input[name="form_id"]').val(),k=this.hash.replace(/#/g,"");f.post(ajaxurl,{action:"visual_form_builder_form_settings",form:l,accordion:k,page:pagenow})});var c=false;f("#vfb-form-builder-management input, #vfb-form-builder-management select, #vfb-form-builder-management textarea").change(function(){g()});function g(){c=true}window.onbeforeunload=function(){if(c){return"The changes you made will be lost if you navigate away from this page."}};f(document).on("submit","#visual-form-builder-update",function(){window.onbeforeunload=null});if(f(".columns-2 #side-sortables").length>0){var a=f("#vfb_form_items_meta_box"),e=a.offset(),b=55;f(window).on("scroll",function(){if(f(window).scrollTop()>e.top){a.stop().css({marginTop:f(window).scrollTop()-e.top+b})}else{a.stop().css({marginTop:0})}})}var i=f(".form-success-type:checked").val();f("#form-success-message-"+i).show();f(".form-success-type").change(function(){var k=f(this).val();switch(k){case"text":f("#form-success-message-text").show();f("#form-success-message-page, #form-success-message-redirect").hide();break;case"page":f("#form-success-message-page").show();f("#form-success-message-text, #form-success-message-redirect").hide();break;case"redirect":f("#form-success-message-redirect").show();f("#form-success-message-text, #form-success-message-page").hide();break}});f(".vfb-field-types").click(function(l){l.preventDefault();f("#vfb-field-tabs li").removeClass("tabs");f(this).parent().addClass("tabs");f(".tabs-panel-active").removeClass("tabs-panel-active").addClass("tabs-panel-inactive");var k=this.hash;f(k).removeClass("tabs-panel-inactive").addClass("tabs-panel-active")});f("#visual-form-builder-update").validate({rules:{"form_email_to[]":{email:true},form_email_from:{email:true},form_success_message_redirect:{url:true},form_notification_email_name:{required:function(k){return f("#form-notification-setting").is(":checked")}},form_notification_email_from:{required:function(k){return f("#form-notification-setting").is(":checked")},email:true},form_notification_email:{required:function(k){return f("#form-notification-setting").is(":checked")}}},errorPlacement:function(k,l){k.insertAfter(l.parent())}});f("#visual-form-builder-new-form").validate();f("#form_email_from_name_override").change(function(){if(f("#form_email_from_name_override").val()==""){f("#form-email-sender-name").prop("readonly",false)}else{f("#form-email-sender-name").prop("readonly","readonly")}});f("#form_email_from_override").change(function(){if(f("#form_email_from_override").val()==""){f("#form-email-sender").prop("readonly",false)}else{f("#form-email-sender").prop("readonly","readonly")}});f("#notification-email").toggle(f("#form-notification-setting").prop("checked"));f("#form-notification-setting").change(function(){var k=f(this).is(":checked");if(k){f("#notification-email").show();f("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").prop("disabled",false)}else{f("#notification-email").hide();f("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").prop("disabled","disabled")}});f("#vfb-export-select-all").click(function(k){k.preventDefault();f('#vfb-export-entries-fields input[type="checkbox"]').prop("checked",true)});f("#vfb-export-entries-forms").change(function(){var l=f(this).val(),k=h(l);f("#vfb-export-entries-fields").html("Loading...");f.get(ajaxurl,{action:"visual_form_builder_export_load_options",id:l,count:k,page:pagenow}).done(function(m){f("#vfb-export-entries-fields").html(m)}).fail(function(m){f("#vfb-export-entries-fields").html("Error loading entry fields.")})});f("#vfb-export-entries-rows").change(function(){var l=f("#vfb-export-entries-forms").val();var k=f(this).val();f("#vfb-export-entries-fields").html("Loading...");f.get(ajaxurl,{action:"visual_form_builder_export_load_options",id:l,offset:k,page:pagenow}).done(function(m){f("#vfb-export-entries-fields").html(m)}).fail(function(m){f("#vfb-export-entries-fields").html("Error loading entry fields.")})});function h(l){var k="";f.ajax(ajaxurl,{async:false,data:{action:"visual_form_builder_export_entries_count",id:l,page:pagenow}}).done(function(m){if(m>1000){f("#vfb-export-entries-rows").empty();var o=Math.ceil(parseInt(m)/1000);for(var n=1;n<=o;n++){f("#vfb-export-entries-rows").append(f("<option></option>").attr("value",n).text(n))}f("#vfb-export-entries-pages").show()}else{f("#vfb-export-entries-pages").hide()}k=m}).fail(function(m){});return k}});