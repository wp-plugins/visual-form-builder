jQuery(document).ready(function(e){if(pagenow=="toplevel_page_visual-form-builder"){e(".if-js-closed").removeClass("if-js-closed").addClass("closed");postboxes.add_postbox_toggles("toplevel_page_visual-form-builder")}var a=null;e(document).on("mouseenter mouseleave",".vfb-tooltip",function(j){if(j.type=="mouseenter"){if(a){clearTimeout(a);a=null}var g=e(this).attr("title"),i=e(this).attr("rel"),h=e(this).width();e(this).append('<div class="tooltip"><h3>'+g+'</h3><p class="text">'+i+"</p></div>");e.data(this,"title",g);this.title="";e(this).find(".tooltip").css({left:h+22});a=setTimeout(function(){e(".tooltip").fadeIn(300)},500)}else{this.title=e.data(this,"title");e(".tooltip").fadeOut(500);e(this).children().remove()}});e(document).on("click","a.addOption",function(m){m.preventDefault();var h=e(this).parent().parent().find(".clonedOption").length;var l=h+1;var n=e(this).closest("div").attr("id");var k=e(this).closest("div").children("label").attr("for");var g=k.replace(new RegExp(/(\d+)$/g),"");var j=n.replace(new RegExp(/(\d+)$/g),"");var i=e("#"+n).clone().attr("id",j+l);i.children("label").attr("for",g+l);i.find('input[type="text"]').attr("id",g+l);i.find('input[type="radio"]').attr("value",l);e("#"+j+h).after(i)});e(document).on("click","a.deleteOption",function(h){h.preventDefault();var g=e(this).parent().parent().find(".clonedOption").length;if(g-1==0){alert("You must have at least one option.")}else{e(this).closest("div").remove()}});e(document).on("click","a.addEmail",function(m){m.preventDefault();var h=e(this).closest("#email-details").find(".clonedOption").length;var l=h+1;var n=e(this).closest("div").attr("id");var k=e(this).closest("div").find("label").attr("for");var g=k.replace(new RegExp(/(\d+)$/g),"");var j=n.replace(new RegExp(/(\d+)$/g),"");var i=e("#"+n).clone().attr("id",j+l);i.find("label").attr("for",g+l);i.find("input").attr("id",g+l);e("#"+j+h).after(i)});e(document).on("click","a.deleteEmail",function(h){h.preventDefault();var g=e(this).closest("#email-details").find(".clonedOption").length;if(g-1==0){alert("You must have at least one option.")}else{e(this).closest("div").remove()}});e(".menu-delete, .entry-delete").click(function(){var g=(e(this).hasClass("entry-delete"))?"entry":"form";var h=confirm("You are about to permanently delete this "+g+" and all of its data.\n'Cancel' to stop, 'OK' to delete.");if(h){return true}return false});e(document).on("click","a.item-edit",function(g){g.preventDefault();e(g.target).closest("li").children(".menu-item-settings").slideToggle("fast");e(this).toggleClass("opened")});e("#menu-to-edit").nestedSortable({listType:"ul",maxLevels:3,handle:".menu-item-handle",placeholder:"sortable-placeholder",tolerance:"pointer",toleranceElement:"> dl",items:"li:not(.ui-state-disabled)",create:function(g,h){e(this).css("min-height",e(this).height())},start:function(g,h){h.placeholder.height(h.item.height())},stop:function(g,h){opts={url:ajaxurl,type:"POST",async:true,cache:false,dataType:"json",data:{action:"visual_form_builder_process_sort",order:e(this).nestedSortable("toArray")},success:function(i){e("#loading-animation").hide();return}};e.ajax(opts)}});e("#form-items .vfb-draggable-form-items").click(function(g){g.preventDefault();e(this).data("submit_value",e(this).text())});e(document).on("click","#form-items .vfb-draggable-form-items",function(i){i.preventDefault();var j=e(this).closest("form").serializeArray(),h=e(this).data("submit_value"),g=e("#menu-to-edit li.ui-state-disabled:first").attr("id").match(new RegExp(/(\d+)$/g))[0];e("img.waiting").show();e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_create_field",data:j,field_type:h,previous:g,page:pagenow,nonce:e("#_wpnonce").val()},success:function(k){e("img.waiting").hide();e(k).hide().insertBefore("#menu-to-edit li.ui-state-disabled:first").fadeIn();return},error:function(l,m,k){alert(l+" "+m+" "+k);return}})});e(document).on("click","a.item-delete",function(n){n.preventDefault();var l=childs=new Array(),r=0,h=e(this).attr("href"),g=h.split("&");for(var m=0;m<g.length;m++){var p=g[m].indexOf("=");var o=g[m].substring(0,p);var q=g[m].substring(p+1);l[o]=q}var j=e(this).closest(".form-item").find("ul").children();var k=j.parent().html();j.each(function(t){childs[t]=e(this).attr("id").match(new RegExp(/(\d+)$/g))[0]});var s=e(this).closest("li.form-item").parents("li.form-item");if(s.length){r=s.attr("id").match(new RegExp(/(\d+)$/g))[0]}e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,dataType:"html",data:{action:"visual_form_builder_delete_field",form:l.form,field:l.field,child_ids:childs,parent_id:r,page:pagenow,nonce:l._wpnonce},success:function(i){e("#form_item_"+l.field).addClass("deleting").animate({opacity:0,height:0},350,function(){e(this).before(k).remove()});return},error:function(t,u,i){alert("There was an error loading the content");return}})});e("#form-settings-button").click(function(i){i.preventDefault();e(this).toggleClass("current");e("#form-settings").slideToggle();var g=e('input[name="form_id"]').val(),h=(e(this).hasClass("current"))?"opened":"closed";e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,data:{action:"visual_form_builder_form_settings",form:g,status:h,page:pagenow},success:function(j){if(h=="closed"){e(".settings-links").removeClass("on");e(".settings-links:first").addClass("on");e(".form-details").slideUp("normal");e(".form-details:first").show("normal")}},error:function(k,l,j){alert("There was an error loading the content");return}})});e(".settings-links").click(function(i){i.preventDefault();e(".settings-links").removeClass("on");e(".form-details").slideUp("normal");if(e(this).next("div").is(":hidden")==true){e(this).addClass("on");e(this).next().slideDown("normal")}var h=e('input[name="form_id"]').val(),g=this.hash.replace(/#/g,"");e.ajax({url:ajaxurl,type:"POST",async:true,cache:false,data:{action:"visual_form_builder_form_settings",form:h,accordion:g,page:pagenow},success:function(j){},error:function(k,l,j){alert("There was an error loading the content");return}})});if(e(".columns-2 #side-sortables").length>0){var d=e("#vfb_form_items_meta_box"),f=d.offset(),b=55;e(window).on("scroll",function(){if(e(window).scrollTop()>f.top){d.stop().css({marginTop:e(window).scrollTop()-f.top+b})}else{d.stop().css({marginTop:0})}})}var c=e(".form-success-type:checked").val();e("#form-success-message-"+c).show();e(".form-success-type").change(function(){var g=e(this).val();if("text"==g){e("#form-success-message-text").show();e("#form-success-message-page, #form-success-message-redirect").hide()}else{if("page"==g){e("#form-success-message-page").show();e("#form-success-message-text, #form-success-message-redirect").hide()}else{if("redirect"==g){e("#form-success-message-redirect").show();e("#form-success-message-text, #form-success-message-page").hide()}}}});e(".vfb-field-types").click(function(h){h.preventDefault();e("#vfb-field-tabs li").removeClass("tabs");e(this).parent().addClass("tabs");e(".tabs-panel-active").removeClass("tabs-panel-active").addClass("tabs-panel-inactive");var g=this.hash;e(g).removeClass("tabs-panel-inactive").addClass("tabs-panel-active")});e("#visual-form-builder-update").validate({rules:{"form_email_to[]":{email:true},form_email_from:{email:true},form_success_message_redirect:{url:true},form_notification_email_name:{required:function(g){return e("#form-notification-setting").is(":checked")}},form_notification_email_from:{required:function(g){return e("#form-notification-setting").is(":checked")},email:true},form_notification_email:{required:function(g){return e("#form-notification-setting").is(":checked")}}},errorPlacement:function(g,h){g.insertAfter(h.parent())}});e("#form_email_from_name_override").change(function(){if(e("#form_email_from_name_override").val()==""){e("#form-email-sender-name").attr("readonly",false)}else{e("#form-email-sender-name").attr("readonly","readonly")}});e("#form_email_from_override").change(function(){if(e("#form_email_from_override").val()==""){e("#form-email-sender").attr("readonly",false)}else{e("#form-email-sender").attr("readonly","readonly")}});if(e("#form-notification-setting").is(":checked")){e("#notification-email").show()}else{e("#notification-email").hide()}e("#form-notification-setting").change(function(){var g=e(this).is(":checked");if(g){e("#notification-email").show();e("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").attr("disabled",false)}else{e("#notification-email").hide();e("#form-notification-email-name, #form-notification-email-from, #form-notification-email, #form-notification-subject, #form-notification-message, #form-notification-entry").attr("disabled","disabled")}})});